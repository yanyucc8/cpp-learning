## C++ 右值引用

### 1.C++左值和右值

右值(read value, rvalue)：

左值(located value, lvalue)：

通常有两种方法，来判断某个表达式是右值还是左值

1.赋值号（=）的左侧的表达式为左值，右侧为右值

```c++
int a = 10;
10 = a;//error
```

变量a为一个左值，10是右值。

C++的左值也可以作为右值

```c++
int b = 20;
a = b;
```

2.有变量名称，或能取到存储地址的表达式为左值，反之则为右值

以上代码中，变量a和b都能取到地址&a和&b，因此a和b是左值，而数字10和20，既没有变量名称，又不能取到它们的存储地址，因此10和20是右值。

例如，程序执行结果中产生的临时对象（例如函数返回值、lambda 表达式等）既无名称也无法获取其存储地址，所以属于右值。

### 2.左值引用

通过引用&，我们可以对左值建立引用，来完成对左值的修改。（左值引用必须初始化）

```c++
int num = 100;
int &c = num;
int &d = 100;//error
```

但我们无法直接对一个右值建立引用，因为右值是没有内存地址的，那么我们就不能通过建立引用来直接访问右值。

但是编译器允许我们可以==通过const来修饰变量，来建立对右值的访问==

```c++
int num = 100;
const int &c = num;
const int &d = 100;
```

以上代码中，const左值引用既可以指向左值num，又可以指向右值（注意这里我们是没有办法通过左值d来修改它所指向的右值的。）

*由于引用的本质是指针常量，在前面加const，即指针和指针所指向的值都不可以修改。*

```c++
int func(int & x_)
{
	return x_ * x_;
}

int main()
{
	int x = func(10); //error:cannot bind non-const lvalue reference of type 'int&' to an rvalue of type 'int'
}
```

这里我们在函数中传入的临时值 `10` 作为函数的参数，产生了将右值转换为左值的错误，相当于 `int & x_ = 10;` 这就跟前文出现的error一样了，非const左值引用是无法访问右值的。

解决的办法是 改成const左值引用，这样我们就可以在调用函数的时候直接传入数字(右值)。

```c++
int func(const int & x_)
{
	return x_ * x_;
}

int main()
{
	int x = func(10); 
}
```

这样我们就通过const左值引用建立起对右值的访问。

*在应用中：C++中经常通过const引用来将值传入函数中，这避免了不必要的临时对象的创建和拷贝。*
编译器会为你创建一个隐藏的变量（即一个左值）来存储初始的字面常量，然后将隐藏的变量绑定到你的引用上去。那跟我之前的一组代码片段中手动完成的是一码事，例如：

```c++
// the following...
const int& ref = 10;

// ... would translate to:
int __internal_unique_name = 10;
const int& ref = __internal_unique_name;
```

### 3.右值引用

那么如果我们想对右值进行修改时，就不能利用左值引用。在c++11中引入了右值引用，用 `&&`来表示。

需要注意的是，**==和声明左值引用一样，右值引用也必须立即进行初始化操作，且只能使用右值进行初始化==**，比如：

```c++
int num = 100;
int && a = 100;
int && b = num;//error,右值引用不能用左值进行初始化
```

和左值引用不同的是，右值引用是可以对右值进行修改的。比如：

```c++
int && a = 100;
a = 88;//legal
cout << "a = " << a << endl;// a = 88
```

另外c++语法上支持const右值引用。比如：

```c++
const int && a = 100;//编译器不会报错
```

 但这种定义出来的右值引用并无实际用处。一方面，右值引用主要用于移动语义和完美转发，其中前者需要有修改右值的权限；其次，const右值引用的作用就是引用一个不可修改的右值，这项工作完全可以交给常量左值引用完成。

学到这里，一些读者可能无法记清楚左值引用和右值引用各自可以引用左值还是右值，这里给大家一张表格，方便大家记忆：  

表 c++左值引用和右值引用

|   引用类型              |  非const左值    |const左值      | 非const右值     |const右值      |  使用场景    |
| :-------------- | :--- | ---- | ---- | ---- | ---- |
| 非const左值引用 | Yes | \ | \ | \ | 无 |
| const左值引用   | Yes | Yes | Yes | Yes | 用于类中构建拷贝构造函数 |
| 非const右值引用 | \ | \ | Yes | \ | 移动语义、完美转发 |
| const右值引用   | \ | \ | Yes | Yes | 无实际用途 |
































